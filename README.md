# 六爻占卜系统

基于文王卦（京房易）体系的专业排盘与解卦系统。

## 特点

- **规则准确**：所有排盘与解卦基于明确的六爻规则，不是"凭感觉"
- **可追溯**：每一步推导都可以展开查看"为什么"
- **可测试**：核心排盘逻辑有完整的单元测试和快照测试
- **双层解读**：同时提供"白话层"（新手友好）和"命理层"（专业分析）
- **现代体验**：响应式设计、深色模式、可分享链接

## 规则来源说明

本系统基于以下传统典籍的规则体系：

### 核心规则来源

1. **《周易》** - 六十四卦的基础结构
2. **《京氏易传》** - 纳甲法、八宫卦序、世应定位规则
3. **《增删卜易》（野鹤老人）** - 用神选取、旺衰判断、解卦要点
4. **《卜筮正宗》** - 补充规则、实例验证

### 规则模块说明

| 模块 | 规则来源 | 确定性 |
|-----|---------|-------|
| 干支历法 | 天文算法 | ✅ 确定性计算 |
| 纳甲装卦 | 京房纳甲法 | ✅ 确定性规则 |
| 六亲取法 | 五行生克 | ✅ 确定性规则 |
| 六神排列 | 日干起六神 | ✅ 确定性规则 |
| 世应定位 | 八宫卦序 | ✅ 确定性规则 |
| 旺衰判断 | 月令五行 | ✅ 确定性规则 |
| 用神选取 | 问事类别 | ⚠️ 有多种流派 |
| 解卦推断 | 规则聚合 | ⚠️ 存在不确定性 |

### 重要声明

- **排盘计算是确定性的**：同样的输入必然得到同样的输出
- **解卦结论是规则聚合的推断**：存在不确定性，不同流派可能有不同解读
- **不做医疗/法律/投资的确定性建议**：本系统仅供参考

## 快速开始

### 安装依赖

```bash
pnpm install
```

### 开发模式

```bash
pnpm dev
```

访问 http://localhost:3000

### 运行测试

```bash
pnpm test        # 运行测试
pnpm test:run    # 运行一次测试
pnpm test:coverage  # 查看测试覆盖率
```

### 构建生产版本

```bash
pnpm build
pnpm start
```

## 项目结构

```
liuyao-divination/
├── src/
│   ├── app/                    # Next.js App Router 页面
│   │   ├── page.tsx           # 首页
│   │   ├── cast/              # 起卦页面
│   │   └── layout.tsx         # 布局
│   ├── components/
│   │   ├── ui/                # 通用 UI 组件
│   │   └── liuyao/            # 六爻专用组件
│   │       ├── CoinFlip.tsx   # 铜钱投掷动画
│   │       ├── HexagramDisplay.tsx  # 卦象显示
│   │       └── ResultDisplay.tsx    # 结果展示
│   ├── lib/
│   │   └── liuyao/            # 核心规则引擎
│   │       ├── types.ts       # 类型定义
│   │       ├── constants.ts   # 常量（八卦、六十四卦等）
│   │       ├── ganzhi.ts      # 干支历法模块
│   │       ├── hexagram.ts    # 卦象生成模块
│   │       ├── najia.ts       # 纳甲装卦模块
│   │       ├── liushen.ts     # 六神模块
│   │       ├── prosperity.ts  # 旺衰分析模块
│   │       ├── relations.ts   # 关系分析模块
│   │       ├── yongshen.ts    # 用神选取模块
│   │       ├── interpretation.ts  # 解卦引擎
│   │       ├── engine.ts      # 主引擎
│   │       └── engine.test.ts # 测试文件
│   └── store/                 # 状态管理
└── ...配置文件
```

## 起卦方式

### 1. 三枚铜钱法（推荐）

最传统、最标准的起卦方式。

- 虚拟投掷三枚铜钱
- 字面=2分，背面=3分
- 三枚铜钱相加：6=老阴（动），7=少阳，8=少阴，9=老阳（动）
- 重复6次得到完整卦象

### 2. 时间起卦

根据起卦时间自动计算。

- 上卦 = (年数 + 月数 + 日数) mod 8
- 下卦 = (年数 + 月数 + 日数 + 时数) mod 8
- 动爻 = 总数 mod 6

### 3. 手动输入

直接选择每爻的阴阳和动静状态，适合导入已有卦例。

## 测试用例（快照）

系统包含 10 个固定卦例的快照测试：

1. 乾为天（六爻皆阳）
2. 坤为地（六爻皆阴）
3. 天地否（初爻动）
4. 地天泰
5. 水火既济（三爻动）
6. 火水未济
7. 雷水解
8. 山水蒙
9. 风雷益（二爻动）
10. 泽山咸

运行 `pnpm test` 验证这些卦例的稳定性。

## 技术栈

- **框架**: Next.js 14 (App Router)
- **语言**: TypeScript (strict mode)
- **样式**: TailwindCSS
- **动画**: Framer Motion
- **状态管理**: Zustand
- **测试**: Vitest
- **UI组件**: 基于 Radix UI 的自定义组件

## 部署

### Vercel 一键部署

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/your-repo/liuyao-divination)

### 环境变量

无需配置环境变量，V1 版本不需要数据库。

## 后续计划

- [ ] 历史记录功能（可选存档）
- [ ] 导出图片/PDF
- [ ] 更多细分的用神选取规则
- [ ] 伏神查找功能
- [ ] 多语言支持

## 许可证

MIT License

## 免责声明

本系统仅供学习和研究使用，提供的是"结构化判断参考"，不是命令。

- 不构成任何医疗、法律、投资等专业建议
- 用户始终保有决策权
- 开发者不对使用结果承担任何责任
